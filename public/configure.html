<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Spec Kit éœ€æ±‚é…ç½®å™¨</title>
  <link rel="icon" type="image/png" href="icon.png" />
  <script src="javascript/tailwindcss.js"></script>
  <script src="javascript/vue.global.js"></script>
  <script src="components/header.js"></script>
  <style>
    .gradient-bg {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }

    /* ç¡®ä¿headerå¯¼èˆªæŒ‰é’®ä¸æ¢è¡Œ */
    nav {
      flex-shrink: 0;
    }

    /* ä»»åŠ¡å¯¼èˆªå¡ç‰‡ */
    .question-nav-card {
      position: sticky;
      top: 100px;
      max-height: calc(100vh - 120px);
      overflow-y: auto;
    }

    /* æ»šåŠ¨æ¡æ ·å¼ */
    .question-nav-card::-webkit-scrollbar {
      width: 6px;
    }

    .question-nav-card::-webkit-scrollbar-track {
      background: #f1f1f1;
      border-radius: 10px;
    }

    .question-nav-card::-webkit-scrollbar-thumb {
      background: #888;
      border-radius: 10px;
    }

    .question-nav-card::-webkit-scrollbar-thumb:hover {
      background: #555;
    }
  </style>
</head>

<body class="bg-gray-50 min-h-screen">
  <div id="app"></div>

  <!-- é¡µé¢æ¨¡æ¿ -->
  <script type="text/x-template" id="configure-template">
    <div class="min-h-screen flex flex-col">
      <!-- Navigation Header -->
      <page-header current-page="configure"></page-header>
    
      <!-- Main Content -->
      <div class="flex-1 container mx-auto px-4 py-8">
        <!-- Project Selection -->
        <div v-if="projects.length > 1 && !loading && !loadError && !submitted" class="max-w-7xl mx-auto mb-6">
          <div class="bg-white rounded-lg shadow-lg p-6">
            <label class="block text-lg font-semibold text-gray-700 mb-3 flex items-center">
              <span class="text-2xl mr-2">ğŸ¯</span>
              é€‰æ‹©é¡¹ç›®
            </label>
            <select v-model="selectedProject" @change="handleProjectChange"
              class="w-full px-4 py-3 text-lg border-2 border-purple-300 rounded-lg focus:border-purple-600 focus:outline-none transition-colors bg-white cursor-pointer hover:border-purple-400">
              <option v-for="project in projects" :key="project.filePath" :value="project.filePath">
                {{ project.title }}
              </option>
            </select>
          </div>
        </div>
    
        <div class="max-w-7xl mx-auto" :class="submitted || loading || loadError ? '' : 'grid grid-cols-1 lg:grid-cols-[1fr,300px] gap-6'">
          <!-- å·¦ä¾§ï¼šä»»åŠ¡å†…å®¹ -->
          <div class="bg-white rounded-2xl shadow-2xl overflow-hidden" :class="submitted || loading || loadError ? 'max-w-3xl mx-auto' : ''">
            <!-- Page Header -->
            <div class="gradient-bg text-white py-8 px-8 text-center">
              <h2 class="text-3xl font-bold mb-2">é…ç½®æ‚¨çš„é¡¹ç›®éœ€æ±‚</h2>
              <p class="text-purple-100 text-base">é€šè¿‡å¯è§†åŒ–ç•Œé¢å¿«é€Ÿé…ç½®æ‚¨çš„é¡¹ç›®éœ€æ±‚</p>
            </div>
    
            <!-- Loading -->
            <div v-if="loading" class="text-center py-16 px-5 text-gray-600">
              <div
                class="inline-block w-10 h-10 border-4 border-gray-200 border-t-indigo-500 rounded-full animate-spin mb-5">
              </div>
              <p>æ­£åœ¨åŠ è½½é…ç½®...</p>
            </div>
    
            <!-- Load Error -->
            <div v-else-if="loadError" class="text-center py-16 px-5">
              <p class="text-red-500">âŒ åŠ è½½å¤±è´¥: {{ loadError }}</p>
            </div>
    
            <!-- Success Message -->
            <div v-else-if="submitted" class="text-center py-16 px-5">
              <div class="text-6xl mb-5">âœ…</div>
              <h2 class="text-2xl font-bold mb-2 text-green-600">æäº¤æˆåŠŸï¼</h2>
              <p class="text-gray-600 mb-4">æ‚¨çš„éœ€æ±‚å·²æˆåŠŸæäº¤ï¼Œæ­£åœ¨å¤„ç†ä¸­...</p>
              <p class="text-gray-500 text-sm">æ‚¨å¯ä»¥å…³é—­æ­¤çª—å£äº†</p>
            </div>
    
            <!-- Content -->
            <div v-else-if="config">
              <div class="p-8">
                <!-- Project Info -->
                <div v-if="config.projectName || config.projectDescription" class="bg-gray-50 p-5 rounded-lg mb-8">
                  <h2 class="text-gray-800 text-xl font-semibold mb-2">
                    {{ config.projectName || 'é¡¹ç›®é…ç½®' }}
                  </h2>
                  <p class="text-gray-600 leading-relaxed">
                    {{ config.projectDescription || '' }}
                  </p>
                </div>
    
                <!-- Sections -->
                <div v-for="(section, sectionIndex) in config.sections" :key="sectionIndex"
                  class="mb-10 border-l-4 border-indigo-500 pl-5">
    
                  <!-- Section Header -->
                  <div class="flex items-center mb-5">
                    <div class="text-4xl mr-4">{{ section.icon || 'ğŸ“‹' }}</div>
                    <div class="flex-1">
                      <h3 class="text-gray-800 text-xl font-semibold mb-1">{{ section.title }}</h3>
                      <p class="text-gray-600 text-sm">{{ section.description || '' }}</p>
                    </div>
                  </div>
    
                  <!-- Questions -->
                  <div v-for="(question, questionIndex) in section.questions" :key="questionIndex"
                    :id="'question_' + getQuestionId(sectionIndex, questionIndex)"
                    class="mb-6 p-5 bg-gray-50 rounded-lg scroll-mt-24">
    
                    <!-- Question Label -->
                    <div class="flex items-center mb-3 text-gray-800 font-medium text-base">
                      <span
                        class="bg-indigo-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs mr-2">{{
                        getQuestionNumber(sectionIndex, questionIndex) }}</span>
                      <span>{{ question.label }}</span>
                      <span v-if="question.required" class="text-red-500 ml-1">*</span>
                    </div>
    
                    <!-- Checkbox -->
                    <div v-if="question.type === 'checkbox'" class="flex flex-wrap gap-2">
                      <label v-for="(option, optionIndex) in question.options" :key="optionIndex"
                        class="inline-flex items-center bg-white border-2 border-gray-200 rounded-lg px-4 py-2 cursor-pointer transition-all hover:border-indigo-500 hover:shadow-md">
                        <input type="checkbox" 
                          :id="getOptionId(sectionIndex, questionIndex, optionIndex)"
                          v-model="answers[getQuestionId(sectionIndex, questionIndex)]"
                          :value="option.value"
                          class="mr-2 w-4 h-4 cursor-pointer text-indigo-600 focus:ring-indigo-500 rounded">
                        <span class="text-sm">{{ option.label }}</span>
                      </label>
                    </div>
    
                    <!-- Radio -->
                    <div v-else-if="question.type === 'radio'" class="flex flex-wrap gap-2">
                      <label v-for="(option, optionIndex) in question.options" :key="optionIndex"
                        class="inline-flex items-center bg-white border-2 border-gray-200 rounded-lg px-4 py-2 cursor-pointer transition-all hover:border-indigo-500 hover:shadow-md">
                        <input type="radio" 
                          :id="getOptionId(sectionIndex, questionIndex, optionIndex)"
                          v-model="answers[getQuestionId(sectionIndex, questionIndex)]"
                          :value="option.value"
                          class="mr-2 w-4 h-4 cursor-pointer text-indigo-600 focus:ring-indigo-500">
                        <span class="text-sm">{{ option.label }}</span>
                      </label>
                      <!-- è‡ªåŠ¨æ·»åŠ "å…¶ä»–"é€‰é¡¹ -->
                      <label
                        class="inline-flex items-center bg-white border-2 border-gray-200 rounded-lg px-4 py-2 cursor-pointer transition-all hover:border-indigo-500 hover:shadow-md">
                        <input type="radio" 
                          :id="getOptionId(sectionIndex, questionIndex, 'custom')"
                          v-model="answers[getQuestionId(sectionIndex, questionIndex)]"
                          value="__custom__"
                          class="mr-2 w-4 h-4 cursor-pointer text-indigo-600 focus:ring-indigo-500">
                        <span class="text-sm">å…¶ä»–</span>
                      </label>
                    </div>
    
                    <!-- Text Input -->
                    <input v-else-if="question.type === 'text'" 
                      type="text" 
                      :id="getQuestionId(sectionIndex, questionIndex)"
                      v-model="answers[getQuestionId(sectionIndex, questionIndex)]"
                      placeholder="è¯·è¾“å…¥..."
                      class="w-full p-3 border-2 border-gray-200 rounded-lg text-sm focus:outline-none focus:border-indigo-500 transition-colors">
    
                    <!-- Textarea -->
                    <textarea v-else-if="question.type === 'textarea'" 
                      :id="getQuestionId(sectionIndex, questionIndex)"
                      v-model="answers[getQuestionId(sectionIndex, questionIndex)]"
                      placeholder="è¯·è¾“å…¥..."
                      class="w-full p-3 border-2 border-gray-200 rounded-lg text-sm focus:outline-none focus:border-indigo-500 transition-colors resize-y min-h-[100px]"></textarea>
    
                    <!-- è‡ªå®šä¹‰è¾“å…¥æ¡†ï¼ˆä»…é€‚ç”¨äº checkbox å’Œ radioï¼‰ -->
                    <input v-if="(question.type === 'checkbox') || (question.type === 'radio' && answers[getQuestionId(sectionIndex, questionIndex)] === '__custom__')" 
                      type="text" 
                      v-model="answers[getQuestionId(sectionIndex, questionIndex) + '_custom']"
                      :placeholder="question.type === 'radio' ? 'è¯·åœ¨æ­¤è¾“å…¥è‡ªå®šä¹‰å†…å®¹' : 'æˆ–è€…è‡ªå®šä¹‰è¾“å…¥ï¼ˆå¯é€‰ï¼‰'"
                      :class="[
                        'w-full px-3 py-2 text-sm border-2 rounded-lg focus:outline-none transition-colors mt-3',
                        question.type === 'radio' && answers[getQuestionId(sectionIndex, questionIndex)] === '__custom__'
                          ? 'border-indigo-500 bg-indigo-50'
                          : 'border-gray-300 focus:border-indigo-500'
                      ]">
    
                    <!-- Example -->
                    <div v-if="question.example"
                      class="text-sm text-gray-600 mt-3 py-2 px-3 bg-white border-l-4 border-indigo-500 rounded">
                      ğŸ’¡ ç¤ºä¾‹ï¼š{{ question.example }}
                    </div>
                  </div>
                </div>
              </div>
    
              <!-- Actions -->
              <div class="flex justify-center py-8 px-8 bg-gray-50">
                <button @click="submitAnswers" :disabled="submitting"
                  class="px-10 py-4 text-base font-semibold bg-gradient-to-r from-indigo-500 to-purple-600 text-white rounded-lg cursor-pointer transition-all hover:-translate-y-0.5 hover:shadow-xl disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:translate-y-0">
                  {{ submitting ? 'æäº¤ä¸­...' : 'âœ… ç¡®è®¤æäº¤' }}
                </button>
              </div>
            </div>
          </div>
    
          <!-- å³ä¾§ï¼šä»»åŠ¡å¯¼èˆªå¡ç‰‡ -->
          <div v-if="config && !loading && !loadError && !submitted" class="hidden lg:block">
            <div class="question-nav-card bg-white rounded-2xl shadow-2xl p-6">
              <!-- å¡ç‰‡æ ‡é¢˜ -->
              <div class="text-center mb-6">
                <h3 class="text-lg font-bold text-gray-800 mb-2">å›ç­”è¿›åº¦</h3>
                <div class="flex items-center justify-center gap-2 text-sm">
                  <span class="text-gray-600">å·²ç­”</span>
                  <span class="text-indigo-600 font-bold text-lg">{{ answeredQuestions }}</span>
                  <span class="text-gray-400">/</span>
                  <span class="text-gray-600 font-bold text-lg">{{ totalQuestions }}</span>
                </div>
                <!-- è¿›åº¦æ¡ -->
                <div class="mt-3 bg-gray-200 rounded-full h-2 overflow-hidden">
                  <div class="bg-gradient-to-r from-indigo-500 to-purple-600 h-full transition-all duration-300"
                    :style="{ width: totalQuestions > 0 ? (answeredQuestions / totalQuestions * 100) + '%' : '0%' }"></div>
                </div>
              </div>
    
              <!-- ä»»åŠ¡ç½‘æ ¼ -->
              <div class="grid grid-cols-5 gap-2">
                <button v-for="item in flattenedQuestions" :key="`${item.sectionIndex}-${item.questionIndex}`"
                  @click="scrollToQuestion(item.sectionIndex, item.questionIndex)" :class="[
                      'w-full aspect-square rounded-lg text-sm font-semibold transition-all',
                      'flex items-center justify-center',
                      'hover:scale-110 hover:shadow-lg',
                      item.isAnswered
                        ? 'bg-gradient-to-br from-indigo-500 to-purple-600 text-white'
                        : 'bg-gray-100 text-gray-600 border-2 border-gray-300 hover:border-indigo-400'
                    ]" :title="item.question.label">
                  {{ item.number }}
                </button>
              </div>
    
              <!-- å›¾ä¾‹è¯´æ˜ -->
              <div class="mt-6 pt-6 border-t border-gray-200 space-y-2 text-xs">
                <div class="flex items-center gap-2">
                  <div class="w-6 h-6 rounded bg-gradient-to-br from-indigo-500 to-purple-600"></div>
                  <span class="text-gray-600">å·²å›ç­”</span>
                </div>
                <div class="flex items-center gap-2">
                  <div class="w-6 h-6 rounded bg-gray-100 border-2 border-gray-300"></div>
                  <span class="text-gray-600">æœªå›ç­”</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    
      <!-- Footer -->
      <footer class="bg-gray-900 text-white py-8 mt-auto">
        <div class="container mx-auto px-4 text-center">
          <p class="text-gray-400">
            åŸºäº <a href="https://github.com/github/spec-kit" class="text-purple-400 hover:text-purple-300"
              target="_blank">Spec Kit</a> é¡¹ç›®åˆ›å»º
          </p>
          <p class="text-gray-500 mt-2">MIT License</p>
        </div>
      </footer>
    </div>
    </script>

  <script>
    const { createApp, ref, reactive, computed, onMounted } = Vue;

    createApp({
      components: {
        "page-header": HeaderComponent,
      },
      setup() {
        // çŠ¶æ€ç®¡ç†
        const config = ref(null);
        const loading = ref(true);
        const loadError = ref("");
        const submitted = ref(false);
        const submitting = ref(false);
        const answers = reactive({}); // ç»Ÿä¸€å­˜å‚¨æ‰€æœ‰ç­”æ¡ˆï¼ˆä½¿ç”¨ v-model ç›´æ¥ç»‘å®šï¼‰
        const projects = ref([]); // é¡¹ç›®åˆ—è¡¨
        const selectedProject = ref(null); // å½“å‰é€‰æ‹©çš„é¡¹ç›®
        const configFilePath = ref(""); // å½“å‰é…ç½®æ–‡ä»¶è·¯å¾„

        // ä» URL å‚æ•°è·å–é…ç½®æ–‡ä»¶è·¯å¾„
        const urlParams = new URLSearchParams(window.location.search);
        const urlConfigPath = urlParams.get("configFilePath");

        // åŠ è½½é¡¹ç›®åˆ—è¡¨
        const loadProjects = async () => {
          try {
            const response = await fetch("/api/gather-configs");
            if (!response.ok) {
              throw new Error("æ— æ³•åŠ è½½é¡¹ç›®åˆ—è¡¨");
            }
            projects.value = await response.json();
          } catch (err) {
            // é™é»˜å¤„ç†é”™è¯¯
          }
        };

        // åŠ è½½é…ç½®
        const loadConfig = async (filePath) => {
          try {
            loading.value = true;
            loadError.value = "";

            if (!filePath) {
              throw new Error("ç¼ºå°‘é…ç½®æ–‡ä»¶è·¯å¾„å‚æ•°");
            }

            configFilePath.value = filePath;
            const url = `/api/config?configFilePath=${encodeURIComponent(
              filePath
            )}`;
            const response = await fetch(url);
            if (!response.ok) {
              throw new Error("æ— æ³•åŠ è½½é…ç½®");
            }
            config.value = await response.json();

            // ç«‹å³åˆå§‹åŒ–é»˜è®¤å€¼ï¼ˆä¸éœ€è¦å»¶è¿Ÿï¼Œå› ä¸ºä½¿ç”¨ v-modelï¼‰
            initDefaultValues();
          } catch (error) {
            loadError.value = error.message;
          } finally {
            loading.value = false;
          }
        };

        // æ”¶é›†ç­”æ¡ˆï¼ˆç›´æ¥ä» answers å“åº”å¼å¯¹è±¡è¯»å–ï¼‰
        const collectAnswers = () => {
          const result = [];

          config.value.sections.forEach((section, sectionIndex) => {
            section.questions.forEach((question, questionIndex) => {
              const questionId = `q_${sectionIndex}_${questionIndex}`;
              const answerValue = answers[questionId];
              const customValue = answers[questionId + '_custom'];

              let answer = "";

              if (question.type === "checkbox") {
                // checkboxï¼šè‡ªå®šä¹‰å†…å®¹é™„åŠ åˆ°é€‰é¡¹ç­”æ¡ˆä¸­
                const selectedOptions = Array.isArray(answerValue) && answerValue.length > 0
                  ? answerValue.join("ã€")
                  : "";
                const customPart = customValue && customValue.trim() ? customValue.trim() : "";

                if (selectedOptions && customPart) {
                  answer = `${selectedOptions}ã€${customPart}`;
                } else {
                  answer = selectedOptions || customPart;
                }
              } else if (question.type === "radio") {
                // radioï¼šå¦‚æœé€‰æ‹©äº†"å…¶ä»–"é€‰é¡¹ï¼Œä½¿ç”¨è‡ªå®šä¹‰å†…å®¹
                if (answerValue === "__custom__") {
                  answer = customValue && customValue.trim() ? customValue.trim() : "";
                } else {
                  answer = answerValue || "";
                }
              } else {
                // textã€textarea ç›´æ¥ä½¿ç”¨å€¼
                answer = answerValue || "";
              }

              result.push({
                section: section.title,
                question: question.label,
                answer: answer,
                required: question.required || false,
              });
            });
          });

          return result;
        };

        // æäº¤ç­”æ¡ˆï¼ˆæŒ‰ç…§åå°æœŸæœ›çš„æ ¼å¼å‘é€æ•°æ®ï¼‰
        const submitAnswers = async () => {
          const collectedAnswers = collectAnswers();

          // æ£€æŸ¥å¿…å¡«é¡¹
          const missingRequired = collectedAnswers.filter(
            (a) => a.required && !a.answer
          );
          if (missingRequired.length > 0) {
            alert(
              "è¯·å¡«å†™æ‰€æœ‰å¿…å¡«é¡¹ï¼š\n" +
              missingRequired.map((a) => `- ${a.question}`).join("\n")
            );
            return;
          }

          // æ£€æŸ¥å•é€‰é¢˜ï¼šå¦‚æœé€‰æ‹©äº†"å…¶ä»–"ä½†æœªå¡«å†™è‡ªå®šä¹‰å†…å®¹
          const invalidCustom = [];
          config.value.sections.forEach((section, sectionIndex) => {
            section.questions.forEach((question, questionIndex) => {
              if (question.type === "radio") {
                const questionId = `q_${sectionIndex}_${questionIndex}`;
                const selectedValue = answers[questionId];
                const customValue = answers[questionId + '_custom'];
                if (selectedValue === "__custom__" && (!customValue || !customValue.trim())) {
                  invalidCustom.push(question.label);
                }
              }
            });
          });
          if (invalidCustom.length > 0) {
            alert(
              'ä»¥ä¸‹å•é€‰é¢˜é€‰æ‹©äº†"å…¶ä»–"ï¼Œè¯·å¡«å†™è‡ªå®šä¹‰å†…å®¹ï¼š\n' +
              invalidCustom.map((q) => `- ${q}`).join("\n")
            );
            return;
          }

          try {
            submitting.value = true;
            // æŒ‰ç…§åå° formatUserAnswers æœŸæœ›çš„æ ¼å¼å‘é€æ•°æ®
            const response = await fetch("/api/submit", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({
                answers: collectedAnswers  // åŒ…è£…åœ¨ answers å±æ€§ä¸­
              }),
            });

            if (!response.ok) {
              throw new Error("æäº¤å¤±è´¥");
            }

            submitted.value = true;
          } catch (error) {
            alert("æäº¤å¤±è´¥: " + error.message);
          } finally {
            submitting.value = false;
          }
        };

        // ç”Ÿæˆé—®é¢˜ID
        const getQuestionId = (sectionIndex, questionIndex) => {
          return `q_${sectionIndex}_${questionIndex}`;
        };

        // ç”Ÿæˆé€‰é¡¹ID
        const getOptionId = (sectionIndex, questionIndex, optionIndex) => {
          return `q_${sectionIndex}_${questionIndex}_${optionIndex}`;
        };

        // æ£€æŸ¥é—®é¢˜æ˜¯å¦å·²å›ç­”ï¼ˆç›´æ¥æ£€æŸ¥ answers å¯¹è±¡ï¼‰
        const isQuestionAnswered = (questionId, questionType) => {
          const value = answers[questionId];
          const customValue = answers[questionId + '_custom'];

          if (questionType === "checkbox") {
            // checkboxï¼šæœ‰é€‰é¡¹æˆ–æœ‰è‡ªå®šä¹‰å†…å®¹éƒ½ç®—å›ç­”
            const hasOptions = Array.isArray(value) && value.length > 0;
            const hasCustom = customValue && customValue.trim();
            return hasOptions || hasCustom;
          } else if (questionType === "radio") {
            // radioï¼šå¦‚æœé€‰æ‹©äº†"å…¶ä»–"ï¼Œéœ€è¦æ£€æŸ¥è‡ªå®šä¹‰è¾“å…¥æ¡†æ˜¯å¦æœ‰å†…å®¹
            if (value === "__custom__") {
              return customValue && customValue.trim() !== "";
            }
            return value && typeof value === "string" && value.trim() !== "";
          } else {
            // textã€textareaï¼šç›´æ¥æ£€æŸ¥å€¼
            return value && typeof value === "string" && value.trim() !== "";
          }
        };

        // è·å–ä»»åŠ¡åºå·
        const getQuestionNumber = (sectionIndex, questionIndex) => {
          let number = 1;
          for (let i = 0; i < sectionIndex; i++) {
            number += config.value.sections[i].questions.length;
          }
          number += questionIndex;
          return number;
        };

        // æ»šåŠ¨åˆ°æŒ‡å®šä»»åŠ¡
        const scrollToQuestion = (sectionIndex, questionIndex) => {
          const questionId = `q_${sectionIndex}_${questionIndex}`;
          const element = document.getElementById(`question_${questionId}`);
          if (element) {
            element.scrollIntoView({ behavior: "smooth", block: "center" });
          }
        };

        // è®¡ç®—æ€»ä»»åŠ¡æ•°
        const totalQuestions = computed(() => {
          if (!config.value) return 0;
          return config.value.sections.reduce(
            (sum, section) => sum + section.questions.length,
            0
          );
        });

        // è®¡ç®—å·²å›ç­”ä»»åŠ¡æ•°ï¼ˆç›´æ¥æ£€æŸ¥ answers å¯¹è±¡ï¼‰
        const answeredQuestions = computed(() => {
          if (!config.value) return 0;

          let count = 0;
          config.value.sections.forEach((section, sectionIndex) => {
            section.questions.forEach((question, questionIndex) => {
              const questionId = `q_${sectionIndex}_${questionIndex}`;
              if (isQuestionAnswered(questionId, question.type)) {
                count++;
              }
            });
          });
          return count;
        });

        // æ‰å¹³åŒ–æ‰€æœ‰é—®é¢˜ï¼ˆç”¨äºæ¸²æŸ“ä»»åŠ¡ç½‘æ ¼ï¼‰
        const flattenedQuestions = computed(() => {
          if (!config.value) return [];

          const result = [];
          config.value.sections.forEach((section, sectionIndex) => {
            section.questions.forEach((question, questionIndex) => {
              const questionId = `q_${sectionIndex}_${questionIndex}`;
              result.push({
                sectionIndex,
                questionIndex,
                question,
                questionId,
                number: getQuestionNumber(sectionIndex, questionIndex),
                // ç›´æ¥æ£€æŸ¥ answers å¯¹è±¡
                isAnswered: isQuestionAnswered(questionId, question.type)
              });
            });
          });
          return result;
        });

        // åˆå§‹åŒ–é»˜è®¤å€¼ï¼ˆç›´æ¥è®¾ç½®åˆ° answers å¯¹è±¡ï¼‰
        const initDefaultValues = () => {
          if (!config.value) return;

          config.value.sections.forEach((section, sectionIndex) => {
            section.questions.forEach((question, questionIndex) => {
              const questionId = `q_${sectionIndex}_${questionIndex}`;

              // ä¸º checkbox åˆå§‹åŒ–ç©ºæ•°ç»„ï¼ˆå¿…é¡»åˆå§‹åŒ–ï¼Œå¦åˆ™ v-model ä¸å·¥ä½œï¼‰
              if (question.type === "checkbox" && !answers[questionId]) {
                answers[questionId] = [];
              }

              // è®¾ç½®é»˜è®¤å€¼
              if (question.defaultValue) {
                if (question.type === "checkbox") {
                  // checkbox: è½¬æ¢ä¸ºæ•°ç»„
                  answers[questionId] = question.defaultValue
                    .split("ã€")
                    .map((v) => v.trim())
                    .filter(v => v);
                } else {
                  // radio, text, textarea: ç›´æ¥ä½¿ç”¨å­—ç¬¦ä¸²
                  answers[questionId] = question.defaultValue;
                }
              }
            });
          });
        };

        // é¡¹ç›®åˆ‡æ¢å¤„ç†å‡½æ•°
        const handleProjectChange = async (event) => {
          const newPath = event.target.value;
          if (!newPath || newPath === configFilePath.value) {
            return;
          }

          // æ¸…ç©ºä¹‹å‰çš„ç­”æ¡ˆï¼Œé¿å…æ®‹ç•™çŠ¶æ€
          Object.keys(answers).forEach((key) => {
            delete answers[key];
          });

          // é‡ç½®æäº¤çŠ¶æ€ï¼Œç¡®ä¿åˆ‡æ¢åå¯ä»¥ç»§ç»­å¡«å†™
          submitted.value = false;

          await loadConfig(newPath);
          selectedProject.value = newPath;
        };

        // é¡µé¢åŠ è½½æ—¶è·å–é…ç½®
        onMounted(async () => {
          try {
            // å…ˆåŠ è½½é¡¹ç›®åˆ—è¡¨
            await loadProjects();

            // ç¡®å®šè¦åŠ è½½çš„é…ç½®æ–‡ä»¶
            let targetConfigPath = urlConfigPath;

            if (targetConfigPath) {
              // å¦‚æœURLä¸­æœ‰æŒ‡å®šè·¯å¾„ï¼Œä½¿ç”¨è¯¥è·¯å¾„
              selectedProject.value = targetConfigPath;
            } else if (projects.value.length > 0) {
              // å¦åˆ™ä½¿ç”¨ç¬¬ä¸€ä¸ªé¡¹ç›®
              selectedProject.value = projects.value[0].filePath;
              targetConfigPath = projects.value[0].filePath;
            } else {
              throw new Error("æ²¡æœ‰æ‰¾åˆ°ä»»ä½•é…ç½®é¡¹ç›®");
            }

            // åŠ è½½é€‰ä¸­çš„é…ç½®
            await loadConfig(targetConfigPath);
          } catch (error) {
            loadError.value = error.message;
            loading.value = false;
          }
        });

        return {
          config,
          loading,
          loadError,
          submitted,
          submitting,
          answers,
          projects,
          selectedProject,
          configFilePath,
          submitAnswers,
          handleProjectChange,
          getQuestionId,
          getOptionId,
          getQuestionNumber,
          scrollToQuestion,
          totalQuestions,
          answeredQuestions,
          flattenedQuestions,
        };
      },

      template: "#configure-template",
    }).mount("#app");
  </script>
</body>

</html>